<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Vista heredada de crm.lead para incluir campos y botón de aprobación -->
    <record id="view_crm_lead_form_boom_extension" model="ir.ui.view">
        <field name="name">crm.lead.form.boom.extension</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_form_view_oppor"/>
        <field name="arch" type="xml">
            <!-- Insertar después de los campos principales -->
            <xpath expr="//sheet/notebook" position="before">
                <group string="Gestión técnica y aprobación" name="boom_approval_group">
                    <group>
                        <field name="x_lead_category"/>
                        <field name="x_delivery_deadline"/>
                        <field name="x_approved_by" readonly="1"/>
                        <field name="x_approved_date" readonly="1"/>
                        <field name="x_duration_since_approved" readonly="1"/>
                    </group>
                    <group>
                        <field name="x_installation_required"/>
                        <field name="x_installation_date" attrs="{'invisible': [('x_installation_required','=',False)]}"/>
                        <field name="x_contract_reference"/>
                        <field name="x_support_required"/>
                    </group>
                </group>
            </xpath>

            <!-- Botón en el header -->
            <xpath expr="//header" position="inside">
                <button name="action_approve_lead"
                        type="object"
                        class="oe_highlight"
                        string="Aprobar Lead"
                        attrs="{'invisible': [('x_approved_date','!=',False)]}"/>
            </xpath>

            <!-- Asegurar Chatter a la derecha (crm.lead ya hereda mail.thread) -->
            <xpath expr="//sheet" position="after">
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </xpath>
        </field>
    </record>
</odoo>